<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jessie Math - é€Ÿç‡å¤§æŒ‘æˆ°</title>

  <style>
    :root{
      /* ===== æ ¸å¿ƒé…è‰²ï¼šæ¸…æ–°é€äº®é¢¨æ ¼ ===== */
      --primary: #6366f1;       /* ä¸»è‰²èª¿ï¼šé›è— */
      --primary-hover: #4f46e5; /* æŒ‰éˆ•æ‡¸åœè‰² */
      --primary-light: #eff6ff; /* æ¥µæ·ºè—èƒŒæ™¯ */
      --accent: #ec4899;        /* é»ç¶´è‰²ï¼šä¿çš®ç²‰ */
      --ring-color: #f59e0b;    /* é ­åƒåœˆåœˆæ©˜é»ƒè‰² */
      
      --bg-body: #f8fafc;       /* èƒŒæ™¯è‰² */
      --card-bg: rgba(255, 255, 255, 0.95); /* å¡ç‰‡åŠé€æ˜ç™½ */
      
      --text-main: #1e293b;     /* æ·±ç°è—æ–‡å­— */
      --text-muted: #64748b;    /* æ¬¡è¦æ–‡å­— */
      --border: #e2e8f0;        /* é‚Šæ¡† */

      /* é™°å½±ç³»çµ±ï¼šæ›´ç¾ä»£çš„æŸ”å’Œé™°å½± */
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
      --shadow-card: 0 10px 30px -5px rgba(0, 0, 0, 0.08);
      --shadow-float: 0 20px 25px -5px rgba(99, 102, 241, 0.15);

      --radius-lg: 24px;
      --radius-md: 16px;
      --radius-pill: 9999px;

      --good: #10b981;
      --bad: #ef4444;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "PingFang TC", "Noto Sans TC", "Microsoft JhengHei", ui-sans-serif, system-ui, -apple-system, sans-serif;
      color: var(--text-main);
      background-color: var(--bg-body);
      /* èƒŒæ™¯å…‰æšˆ */
      background-image: 
        radial-gradient(at 10% 10%, rgba(99, 102, 241, 0.08) 0px, transparent 50%),
        radial-gradient(at 90% 10%, rgba(236, 72, 153, 0.08) 0px, transparent 50%),
        radial-gradient(at 50% 90%, rgba(99, 102, 241, 0.05) 0px, transparent 50%);
      background-attachment: fixed;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    /* ===== å‹•ç•« ===== */
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes popIn { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    .animate-in { animation: fadeIn 0.4s cubic-bezier(0.2, 0.8, 0.2, 1) both; }

    /* ===== Header (Hero å€) ===== */
    .topbar {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-bottom: 1px solid rgba(226, 232, 240, 0.8);
    }
    .topbar-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    /* å·¦å´å“ç‰Œï¼šä¿®æ­£ç‚ºå–®è¡Œæ–‡å­— */
    .brand {
      display: flex;
      align-items: center;
      gap: 14px;
      text-decoration: none;
      color: var(--text-main);
    }
    .avatar-ring {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: #fff;
      border: 3px solid var(--ring-color);
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-shrink: 0;
      box-shadow: 0 2px 8px rgba(245, 158, 11, 0.25);
    }
    .avatar-ring img {
      width: 85%;
      height: 85%;
      object-fit: contain;
    }
    .brand-title {
      font-size: 22px; /* ç¨å¾®åŠ å¤§å­—é«” */
      font-weight: 800;
      color: #1e293b;
      letter-spacing: 0.3px;
    }

    /* å³å´å°è¦½ */
    .nav {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .nav-btn {
      text-decoration: none;
      font-size: 14px;
      font-weight: 700;
      color: var(--text-muted);
      padding: 8px 18px;
      border-radius: var(--radius-pill);
      background: transparent;
      border: 1px solid var(--border);
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .nav-btn svg { width: 17px; height: 17px; stroke-width: 2.5px; }
    
    /* ä¸€èˆ¬æŒ‰éˆ• Hover */
    .nav-btn:hover {
      background: #fff;
      color: var(--primary);
      border-color: var(--primary);
      box-shadow: var(--shadow-sm);
      transform: translateY(-1px);
    }

    /* ç‰¹æ®ŠæŒ‰éˆ•æ¨£å¼ (å›åˆ°ä¸»é¡Œ) */
    .nav-btn.special {
      color: var(--primary);
      border-color: var(--primary);
      background: rgba(99, 102, 241, 0.05);
    }
    .nav-btn.special:hover {
      background: var(--primary);
      color: #fff;
    }

    /* ===== ä½ˆå±€ ===== */
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 20px 60px;
      display: grid;
      grid-template-columns: 1fr 340px; 
      gap: 24px;
    }

    /* ===== å¡ç‰‡é¢¨æ ¼ ===== */
    .card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-card);
      border: 1px solid rgba(255,255,255,0.6);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      position: relative;
    }
    .card-header {
      padding: 28px 28px 12px;
    }
    .card-header h2 {
      margin: 0;
      font-size: 24px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--text-main), var(--primary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .card-header p {
      margin: 8px 0 0;
      color: var(--text-muted);
      font-size: 14px;
      line-height: 1.6;
    }
    .card-body {
      padding: 28px;
      flex: 1;
    }

    /* æ¨™ç±¤ */
    .tag-row { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 14px; }
    .tag {
      font-size: 12px;
      font-weight: 700;
      padding: 5px 12px;
      border-radius: var(--radius-pill);
      background: var(--primary-light);
      color: var(--primary);
      border: 1px solid rgba(99, 102, 241, 0.1);
    }

    /* ===== äº’å‹•å…ƒä»¶ ===== */
    .btn {
      cursor: pointer;
      border: none;
      outline: none;
      padding: 12px 24px;
      border-radius: var(--radius-md);
      font-weight: 700;
      font-size: 15px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }
    /* ä¸»æŒ‰éˆ• */
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), #8b5cf6);
      color: white;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(99, 102, 241, 0.35);
    }
    .btn-primary:active { transform: translateY(0); }

    /* æ¬¡è¦æŒ‰éˆ• */
    .btn-ghost {
      background: white;
      border: 2px solid var(--border);
      color: var(--text-muted);
    }
    .btn-ghost:hover {
      border-color: var(--text-muted);
      color: var(--text-main);
      background: #f8fafc;
      transform: translateY(-1px);
    }

    /* å±éšªæŒ‰éˆ• */
    .btn-danger {
      background: #fff1f2;
      color: #e11d48;
      border: 1px solid #fda4af;
    }
    .btn-danger:hover { background: #ffe4e6; transform: translateY(-1px); }

    .btn-sm { padding: 8px 16px; font-size: 13px; border-radius: 12px; }

    .inp, .select {
      width: 100%;
      max-width: 400px;
      padding: 12px 16px;
      border-radius: var(--radius-md);
      border: 2px solid var(--border);
      font-size: 16px;
      font-weight: 600;
      color: var(--text-main);
      background: #fff;
      transition: 0.2s;
      outline: none;
    }
    .inp:focus, .select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
    }

    /* ===== éŠæˆ²ç•«é¢ ===== */
    .state { display: none; }
    .state.active { display: block; animation: fadeIn 0.4s ease both; }

    .hud {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 24px;
    }
    .hud-box {
      background: #f1f5f9;
      border-radius: 18px;
      padding: 12px;
      text-align: center;
      border: 1px solid rgba(0,0,0,0.03);
    }
    .hud-label { font-size: 12px; font-weight: 700; color: var(--text-muted); margin-bottom: 4px; }
    .hud-val { font-size: 20px; font-weight: 900; color: var(--text-main); font-variant-numeric: tabular-nums; }

    .question-card {
      background: #fff;
      border: 2px dashed #cbd5e1;
      border-radius: var(--radius-md);
      padding: 28px;
      margin: 16px 0;
      text-align: center;
    }
    .q-text { font-size: 18px; font-weight: 800; line-height: 1.5; margin: 0 0 10px; color: #334155; }
    .q-hint { font-size: 14px; color: var(--text-muted); font-weight: 600; }

    .answers-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-top: 20px;
    }
    .ans-btn {
      background: white;
      border: 2px solid var(--border);
      border-radius: 16px;
      padding: 18px;
      font-size: 16px;
      font-weight: 700;
      color: var(--text-main);
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
      box-shadow: 0 2px 4px rgba(0,0,0,0.02);
    }
    .ans-btn:hover:not(:disabled) {
      border-color: var(--primary);
      transform: translateY(-3px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
    }
    .ans-btn:disabled { cursor: default; opacity: 0.7; }
    .ans-btn.good { border-color: var(--good); background: #ecfdf5; color: #047857; }
    .ans-btn.bad { border-color: var(--bad); background: #fef2f2; color: #b91c1c; }

    /* æ‹–æ›³é…å° */
    .match-area { display: none; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px; }
    .match-area.show { display: grid; }
    .match-col {
      background: #f8fafc; border-radius: 16px; padding: 12px;
      border: 1px solid var(--border); min-height: 250px;
    }
    .drag-card {
      background: white; border: 1px solid var(--border);
      border-radius: 12px; padding: 14px; margin-bottom: 10px;
      font-weight: 700; cursor: grab; box-shadow: var(--shadow-sm);
      transition: 0.2s;
    }
    .drag-card:active { cursor: grabbing; transform: scale(0.98); }
    .drop-zone {
      background: white; border: 2px dashed var(--border);
      border-radius: 12px; padding: 12px; margin-bottom: 10px;
      min-height: 54px; display: flex; align-items: center; justify-content: space-between;
      font-weight: 700; transition: 0.2s;
    }
    .drop-zone.hover { border-color: var(--primary); background: var(--primary-light); }
    .drop-zone.done { border-style: solid; border-color: var(--good); background: #ecfdf5; }

    /* æ’è¡Œæ¦œ */
    .lb-list { display: flex; flex-direction: column; gap: 8px; max-height: 500px; overflow-y: auto; }
    .lb-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 14px; background: white; border: 1px solid var(--border);
      border-radius: 14px; font-size: 14px; transition: transform 0.2s;
    }
    .lb-item:hover { transform: translateX(2px); border-color: var(--primary-light); }
    .rank-badge {
      width: 28px; height: 28px; border-radius: 50%;
      background: var(--primary-light); color: var(--primary);
      display: grid; place-items: center; font-weight: 800; font-size: 12px; margin-right: 12px;
    }

    /* è¦†è“‹å±¤ (Pause) */
    .overlay {
      position: fixed; inset: 0; background: rgba(15, 23, 42, 0.4);
      backdrop-filter: blur(8px); z-index: 200;
      display: none; place-items: center; padding: 20px;
    }
    .overlay.show { display: grid; }
    .overlay-card {
      background: white; padding: 36px; border-radius: 24px;
      width: 100%; max-width: 480px; text-align: center;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }

    /* Toast */
    .toast {
      position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
      padding: 10px 20px; border-radius: 99px; font-weight: 800;
      display: none; box-shadow: var(--shadow-float); z-index: 10;
    }
    .toast.good { background: #d1fae5; color: #065f46; display: block; animation: popIn 0.2s; }
    .toast.bad { background: #fee2e2; color: #991b1b; display: block; animation: popIn 0.2s; }

    /* RWD */
    @media (max-width: 900px) {
      .container { grid-template-columns: 1fr; }
    }
    @media (max-width: 600px) {
      .topbar-inner { flex-direction: column; align-items: stretch; gap: 12px; }
      .brand { justify-content: center; }
      .nav { justify-content: center; }
      .hud { grid-template-columns: 1fr 1fr; }
      .answers-grid { grid-template-columns: 1fr; }
      .match-area { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>

  <header class="topbar">
    <div class="topbar-inner">
      <a href="#" class="brand">
        <div class="avatar-ring">
          <img src="JESSIEMATH-Q.png" alt="Jessie Avatar" />
        </div>
        <span class="brand-title">Jessie Math</span>
      </a>

      <nav class="nav">
        <a href="https://jessiemath0703-chu.github.io/website2/" target="_blank" class="nav-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
          é¦–é 
        </a>
        <a href="https://jessiemath0703-chu.github.io/Game-Lobby/" target="_blank" class="nav-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
          éŠæˆ²å¤§å»³
        </a>
        <a href="https://jessiemath0703-chu.github.io/Game-Lobby/#g6-u12" class="nav-btn special">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
          å…­å¹´ç´šé€Ÿç‡
        </a>
      </nav>
    </div>
  </header>

  <div id="pauseOverlay" class="overlay">
    <div class="overlay-card">
      <h2 style="margin:0 0 10px; color:var(--text-main);">æš«åœä¸­ â¸ï¸</h2>
      <p style="color:var(--text-muted); margin-bottom:24px;">æ™‚é–“å…ˆå‡çµä¸€ä¸‹ï¼Œæº–å‚™å¥½å†ç¹¼çºŒã€‚</p>
      <div style="display:flex; gap:12px; justify-content:center; flex-wrap:wrap;">
        <button id="btnResume2" class="btn btn-primary">ç¹¼çºŒæŒ‘æˆ°</button>
        <button id="btnRestart2" class="btn btn-ghost">é‡æ–°é–‹å§‹</button>
        <button id="btnBackMenu2" class="btn btn-danger">é›¢é–‹é—œå¡</button>
      </div>
    </div>
  </div>

  <main class="container animate-in">
    <section class="card">
      <div class="card-header">
        <h2>å…­å¹´ç´šé€Ÿç‡å¤§æŒ‘æˆ°</h2>
        <p>è·é›¢ã€æ™‚é–“ã€é€Ÿç‡â€”â€”ä¸‰ä½ä¸€é«”ã€‚ä½ æ¯ç­”å°ä¸€æ¬¡ï¼Œæ™‚é–“å°±ç«™åœ¨ä½ é€™é‚Šï¼›ç­”éŒ¯ä¸€æ¬¡ï¼Œæ™‚é–“æœƒæºœèµ°ã€‚</p>
        <div class="tag-row">
          <span class="tag">â±ï¸ åˆå§‹ 60 ç§’</span>
          <span class="tag">âœ… ç­”å° +5 ç§’</span>
          <span class="tag">âŒ ç­”éŒ¯ -5 ç§’</span>
          <span class="tag">ğŸ† æ’è¡Œæ¦œ</span>
        </div>
      </div>

      <div class="card-body">
        <div id="stateName" class="state active">
          <div style="display:flex; flex-direction:column; gap:16px; align-items:flex-start;">
            <label style="font-weight:700; color:var(--text-muted);">è«‹è¼¸å…¥ä½ çš„æš±ç¨±ï¼š</label>
            <div style="display:flex; gap:12px; width:100%; flex-wrap:wrap;">
              <input id="playerName" class="inp" type="text" maxlength="16" placeholder="ä¾‹å¦‚ï¼šé€Ÿç‡å°ç‹å­" />
              <button id="btnNameOK" class="btn btn-primary">ä¸‹ä¸€æ­¥</button>
            </div>
          </div>
        </div>

        <div id="stateHow" class="state">
          <div class="question-card" style="text-align:left;">
            <p class="q-text" style="font-size:16px;">ğŸ“œ éŠæˆ²è¦å‰‡èªªæ˜</p>
            <ul style="color:var(--text-muted); line-height:1.8; font-size:14px; font-weight:600; padding-left:20px;">
              <li>æ¯ä¸€é—œåˆå§‹æ™‚é–“ç‚º <b>60 ç§’</b>ã€‚</li>
              <li>ç­”å°ä¸€é¡Œï¼š<span style="color:var(--good)">+5 ç§’</span>ã€+10 åˆ†ã€‚</li>
              <li>ç­”éŒ¯ä¸€é¡Œï¼š<span style="color:var(--bad)">-5 ç§’</span>ã€-2 åˆ†ã€‚</li>
              <li><b>ç¬¬ä¸‰é—œ (é…å°é¡Œ)</b>ï¼šéœ€å®Œæˆä¸‰çµ„é…å°æ‰ç®—ç­”å°ã€‚</li>
              <li>æ™‚é–“æ­¸é›¶å‰‡éŠæˆ²çµæŸã€‚</li>
            </ul>
          </div>
          <div style="display:flex; gap:12px;">
            <button id="btnGoSelect" class="btn btn-primary">é–‹å§‹é¸é—œ</button>
            <button id="btnBackName" class="btn btn-ghost">å›ä¸Šä¸€æ­¥</button>
          </div>
        </div>

        <div id="stateSelect" class="state">
          <h3 style="margin-top:0;">æº–å‚™å‡ºç™¼</h3>
          <div style="display:flex; flex-direction:column; gap:16px; margin-bottom:24px;">
            <div>
              <label style="display:block; font-size:13px; font-weight:700; color:var(--text-muted); margin-bottom:6px;">é¸æ“‡é—œå¡</label>
              <select id="levelSelect" class="select">
                <option value="1">ç¬¬ä¸€é—œï½œèªè­˜é€Ÿç‡</option>
                <option value="2">ç¬¬äºŒé—œï½œè·é›¢ã€é€Ÿç‡ã€æ™‚é–“é—œä¿‚å¼</option>
                <option value="3">ç¬¬ä¸‰é—œï½œç§’é€Ÿã€åˆ†é€Ÿã€æ™‚é€Ÿæ›ç®— (é…å°)</option>
                <option value="4">ç¬¬å››é—œï½œå¹³å‡é€Ÿç‡</option>
                <option value="5">ç¬¬äº”é—œï½œç”Ÿæ´»ä¸­çš„é€Ÿåº¦èˆ‡æ‡‰ç”¨</option>
              </select>
            </div>
            <div>
              <label style="display:block; font-size:13px; font-weight:700; color:var(--text-muted); margin-bottom:6px;">é¸æ“‡é›£åº¦</label>
              <select id="diffSelect" class="select">
                <option value="easy">ç°¡å–® (æ‚ å“‰æ…¢è·‘)</option>
                <option value="normal" selected>æ™®é€š (ç¯€å¥å‰›å¥½)</option>
                <option value="hard">å›°é›£ (é¢¨ä¸€æ¨£å¿«)</option>
              </select>
            </div>
          </div>
          <div style="display:flex; gap:12px;">
            <button id="btnStartGame" class="btn btn-primary">é€²å…¥éŠæˆ²</button>
            <button id="btnBackHow" class="btn btn-ghost">å›èªªæ˜</button>
          </div>
        </div>

        <div id="stateGame" class="state">
          <div class="hud">
            <div class="hud-box">
              <div class="hud-label">ç©å®¶</div>
              <div id="hudName" class="hud-val" style="font-size:16px;">â€”</div>
            </div>
            <div class="hud-box">
              <div class="hud-label">å‰©é¤˜æ™‚é–“</div>
              <div id="hudTime" class="hud-val">60</div>
            </div>
            <div class="hud-box">
              <div class="hud-label">å¾—åˆ†</div>
              <div id="hudScore" class="hud-val">0</div>
            </div>
            <div class="hud-box" style="display:flex; align-items:center; justify-content:center;">
               <button id="btnPause" class="btn btn-ghost btn-sm">æš«åœ</button>
            </div>
          </div>

          <div style="position:relative;">
            <div id="toast" class="toast"></div>
            
            <div class="question-card">
              <p id="qText" class="q-text">é¡Œç›®è¼‰å…¥ä¸­...</p>
              <p id="qHint" class="q-hint"></p>

              <div id="mcqArea" class="answers-grid">
                <button class="ans-btn" id="a0"></button>
                <button class="ans-btn" id="a1"></button>
                <button class="ans-btn" id="a2"></button>
                <button class="ans-btn" id="a3"></button>
              </div>

              <div id="matchArea" class="match-area">
                <div class="match-col">
                  <h4 style="margin:0 0 10px; color:var(--text-muted); font-size:13px;">æ‹–æ›³é¡Œå¡ (å·¦)</h4>
                  <div id="dragHost"></div>
                </div>
                <div class="match-col">
                  <h4 style="margin:0 0 10px; color:var(--text-muted); font-size:13px;">æ”¾ç½®ç­”æ¡ˆ (å³)</h4>
                  <div id="dropHost"></div>
                </div>
              </div>
            </div>
          </div>
          
          <div style="margin-top:16px; display:flex; gap:10px;">
             <button id="btnRestart" class="btn btn-ghost btn-sm">é‡æ–°æœ¬é—œ</button>
             <button id="btnBackMenu" class="btn btn-danger btn-sm">å›é¸å–®</button>
          </div>
        </div>

        <div id="stateResult" class="state">
          <div class="question-card">
            <h2 style="margin:0 0 12px; color:var(--text-main);">æœ¬å±€çµæŸ</h2>
            <div id="resultText" style="line-height:1.8; color:var(--text-muted); font-weight:600;">â€”</div>
          </div>
          <div style="display:flex; gap:12px; justify-content:center;">
            <button id="btnAgain" class="btn btn-primary">å†ç©ä¸€æ¬¡</button>
            <button id="btnToSelect" class="btn btn-ghost">å›é¸é—œ</button>
          </div>
        </div>
      </div>
    </section>

    <aside class="card">
      <div class="card-header" style="padding-bottom:12px; border-bottom:1px solid var(--border);">
        <h3 style="margin:0; font-size:18px;">ğŸ† æ’è¡Œæ¦œ</h3>
        <p style="font-size:12px; margin:4px 0 0;">æœ¬æ©Ÿç´€éŒ„ï¼Œè¶…è¶Šæ˜¨å¤©çš„è‡ªå·±ã€‚</p>
      </div>
      <div class="card-body" style="padding:16px;">
        <div style="display:flex; gap:8px; margin-bottom:12px;">
          <select id="lbFilterLevel" class="select" style="font-size:13px; padding:8px;">
            <option value="all">æ‰€æœ‰é—œå¡</option>
            <option value="1">ç¬¬ä¸€é—œ</option>
            <option value="2">ç¬¬äºŒé—œ</option>
            <option value="3">ç¬¬ä¸‰é—œ</option>
            <option value="4">ç¬¬å››é—œ</option>
            <option value="5">ç¬¬äº”é—œ</option>
          </select>
          <button id="btnClearLB" class="btn btn-danger btn-sm" style="padding:0 12px;">æ¸…ç©º</button>
        </div>
        <div id="lb" class="lb-list"></div>
      </div>
    </aside>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);
    const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
    const shuffle = (arr) => {
      const a = arr.slice();
      for (let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    };
    const rndInt = (a,b)=> Math.floor(Math.random()*(b-a+1))+a;
    const fmt = (n)=>{
      const s = (Math.round(n*1000)/1000).toString();
      return s.replace(/\.0+$/,'').replace(/(\.\d*[1-9])0+$/,'$1');
    };

    const state = {
      name: "",
      level: 1,
      diff: "normal",
      time: 60,
      score: 0,
      correct: 0,
      wrong: 0,
      running: false,
      paused: false,
      timerId: null,
      currentQ: null,
      match: { active:false, total:0, done:0 }
    };

    const LEVEL_NAMES = {
      1: "ç¬¬ä¸€é—œï½œèªè­˜é€Ÿç‡",
      2: "ç¬¬äºŒé—œï½œè·é›¢ã€é€Ÿç‡ã€æ™‚é–“é—œä¿‚å¼",
      3: "ç¬¬ä¸‰é—œï½œç§’é€Ÿã€åˆ†é€Ÿã€æ™‚é€Ÿæ›ç®—",
      4: "ç¬¬å››é—œï½œå¹³å‡é€Ÿç‡",
      5: "ç¬¬äº”é—œï½œç”Ÿæ´»ä¸­çš„é€Ÿåº¦èˆ‡æ‡‰ç”¨"
    };

    const DIFF = {
      easy:   { tickMs: 1000, wrongPenalty: 5, correctBonus: 5, scoreGood: 10, scoreBad: 1 },
      normal: { tickMs: 1000, wrongPenalty: 5, correctBonus: 5, scoreGood: 10, scoreBad: 2 },
      hard:   { tickMs: 1000, wrongPenalty: 5, correctBonus: 5, scoreGood: 12, scoreBad: 3 }
    };

    function pickChoices(correct, baitArr){
      const all = shuffle([correct, ...baitArr.slice(0,3)]);
      return { all, answerIndex: all.indexOf(correct), correct };
    }

    function makeQ_Level1(){
      const d = rndInt(60, 600), t = rndInt(10, 60), v = d/t;
      const correct = `${fmt(v)} å…¬å°º/ç§’`;
      const bait = [`${fmt(d*t)} å…¬å°º/ç§’`, `${fmt(t/d)} å…¬å°º/ç§’`, `${fmt(d/(t+5))} å…¬å°º/ç§’`];
      return { type:"mcq",
        text:`ä¸€å€‹äººè·‘äº† ${d} å…¬å°ºï¼Œç”¨äº† ${t} ç§’ã€‚ä»–çš„é€Ÿç‡æ˜¯å¤šå°‘ï¼Ÿ`,
        hint:`é€Ÿç‡ = è·é›¢ Ã· æ™‚é–“`,
        choices: pickChoices(correct, bait)
      };
    }

    function makeQ_Level2(){
      const mode = rndInt(1,3);
      if(mode===1){
        const v = rndInt(2,10), t = rndInt(8,60), d = v*t;
        return { type:"mcq",
          text:`ä»¥ ${v} å…¬å°º/ç§’ è·‘æ­¥ï¼Œè·‘äº† ${t} ç§’ï¼Œè·é›¢æ˜¯å¤šå°‘ï¼Ÿ`,
          hint:`è·é›¢ = é€Ÿç‡ Ã— æ™‚é–“`,
          choices: pickChoices(`${d} å…¬å°º`, [`${fmt(v/t)} å…¬å°º`, `${fmt(v+t)} å…¬å°º`, `${fmt(v*(t+5))} å…¬å°º`])
        };
      }
      if(mode===2){
        const d = rndInt(120,900), v = rndInt(2,15), t = d/v;
        return { type:"mcq",
          text:`è·é›¢ ${d} å…¬å°ºï¼Œé€Ÿç‡ ${v} å…¬å°º/ç§’ï¼Œéœ€è¦å¤šå°‘ç§’ï¼Ÿ`,
          hint:`æ™‚é–“ = è·é›¢ Ã· é€Ÿç‡`,
          choices: pickChoices(`${fmt(t)} ç§’`, [`${fmt(d*v)} ç§’`, `${fmt(v/d)} ç§’`, `${fmt((d+v)/2)} ç§’`])
        };
      }
      const d = rndInt(100,1000), t = rndInt(10,80), v = d/t;
      return { type:"mcq",
        text:`èµ°äº† ${d} å…¬å°ºï¼Œç”¨äº† ${t} ç§’ï¼Œä»–çš„é€Ÿç‡æ˜¯ï¼Ÿ`,
        hint:`é€Ÿç‡ = è·é›¢ Ã· æ™‚é–“`,
        choices: pickChoices(`${fmt(v)} å…¬å°º/ç§’`, [`${fmt(d*t)} å…¬å°º/ç§’`, `${fmt(t/d)} å…¬å°º/ç§’`, `${fmt((d+t)/2)} å…¬å°º/ç§’`])
      };
    }

    function makeQ_Level4(){
      const d1=rndInt(200,1200), d2=rndInt(200,1200), t1=rndInt(20,120), t2=rndInt(20,120);
      const avg=(d1+d2)/(t1+t2);
      return { type:"mcq",
        text:`ç¬¬ä¸€æ®µ ${d1} å…¬å°ºç”¨ ${t1} ç§’ï¼Œç¬¬äºŒæ®µ ${d2} å…¬å°ºç”¨ ${t2} ç§’ã€‚å¹³å‡é€Ÿç‡ï¼Ÿ`,
        hint:`å¹³å‡é€Ÿç‡ = ç¸½è·é›¢ Ã· ç¸½æ™‚é–“`,
        choices: pickChoices(`${fmt(avg)} å…¬å°º/ç§’`, [
          `${fmt((d1/t1 + d2/t2)/2)} å…¬å°º/ç§’`,
          `${fmt((d1+d2)/Math.max(t1,t2))} å…¬å°º/ç§’`,
          `${fmt((d1+d2)/(t1+t2+10))} å…¬å°º/ç§’`
        ])
      };
    }

    function makeQ_Level5(){
      const mode=rndInt(1,3);
      if(mode===1){
        const run=rndInt(7,14), bike=rndInt(12,25);
        const correct = bike>run ? "é¨è»Šæ¯”è¼ƒå¿«" : "è·‘æ­¥æ¯”è¼ƒå¿«";
        const bait = bike>run ? ["è·‘æ­¥æ¯”è¼ƒå¿«","ä¸€æ¨£å¿«","ä¸èƒ½æ¯”è¼ƒ"] : ["é¨è»Šæ¯”è¼ƒå¿«","ä¸€æ¨£å¿«","ä¸èƒ½æ¯”è¼ƒ"];
        return { type:"mcq",
          text:`è·‘æ­¥ ${run} å…¬é‡Œ/å°æ™‚ï¼Œé¨è»Š ${bike} å…¬é‡Œ/å°æ™‚ï¼Œèª°æ¯”è¼ƒå¿«ï¼Ÿ`,
          hint:`åŒå–®ä½æ¯”å¤§å°`,
          choices: pickChoices(correct, bait)
        };
      }
      if(mode===2){
        const d=rndInt(3,12), v=rndInt(6,18), mins=(d/v)*60;
        return { type:"mcq",
          text:`èµ°è·¯é€Ÿç‡ ${v} å…¬é‡Œ/å°æ™‚ï¼Œè¦èµ° ${d} å…¬é‡Œï¼Œéœ€è¦å¹¾åˆ†é˜ï¼Ÿ`,
          hint:`æ™‚é–“ = è·é›¢ Ã· é€Ÿç‡ï¼Œå† Ã—60 è®Šåˆ†é˜`,
          choices: pickChoices(`${fmt(mins)} åˆ†é˜`, [
            `${fmt(d*v*60)} åˆ†é˜`, `${fmt((v/d)*60)} åˆ†é˜`, `${fmt((d+v)*6)} åˆ†é˜`
          ])
        };
      }
      const d=rndInt(200,800), tA=rndInt(20,80), tB=rndInt(20,80);
      const vA=d/tA, vB=d/tB;
      const correct = vA>vB ? "A æ¯”è¼ƒå¿«" : (vB>vA ? "B æ¯”è¼ƒå¿«" : "ä¸€æ¨£å¿«");
      const bait = ["A æ¯”è¼ƒå¿«","B æ¯”è¼ƒå¿«","ä¸€æ¨£å¿«","ç„¡æ³•åˆ¤æ–·"].filter(x=>x!==correct);
      return { type:"mcq",
        text:`Aã€B éƒ½è·‘ ${d} å…¬å°ºã€‚A ç”¨ ${tA} ç§’ï¼ŒB ç”¨ ${tB} ç§’ï¼Œèª°æ¯”è¼ƒå¿«ï¼Ÿ`,
        hint:`åŒè·é›¢æ¯”æ™‚é–“ï¼šæ™‚é–“å°‘çš„å¿«`,
        choices: pickChoices(correct, bait)
      };
    }

    function generateMCQ(level){
      switch(Number(level)){
        case 1: return makeQ_Level1();
        case 2: return makeQ_Level2();
        case 4: return makeQ_Level4();
        case 5: return makeQ_Level5();
        default: return makeQ_Level1();
      }
    }

    function makeMatch_Level3(){
      const sets=[];
      const cms=rndInt(80,600);
      sets.push({ left:`${cms} å…¬åˆ†/ç§’`, right:`${fmt(cms/100)} å…¬å°º/ç§’` });
      const kmh=rndInt(18,90);
      sets.push({ left:`${kmh} å…¬é‡Œ/å°æ™‚`, right:`${fmt(kmh/3.6)} å…¬å°º/ç§’` });
      const mmin=rndInt(60,360);
      sets.push({ left:`${mmin} å…¬å°º/åˆ†é˜`, right:`${fmt(mmin*60/1000)} å…¬é‡Œ/å°æ™‚` });
      return sets.map((s,i)=>({...s, id:`m${Date.now()}_${i}`}));
    }

    let draggingEl=null;
    function onDragStart(e){
      if(!state.running || state.paused) return;
      draggingEl=e.target;
      draggingEl.classList.add("dragging");
      e.dataTransfer.setData("text/plain", draggingEl.dataset.mid);
    }
    function onDragEnd(){
      if(draggingEl) draggingEl.classList.remove("dragging");
      draggingEl=null;
    }
    function onDrop(e, zone){
      e.preventDefault();
      zone.classList.remove("hover");
      if(!state.running || state.paused) return;

      const mid=e.dataTransfer.getData("text/plain");
      if(!mid) return;

      const card=[...document.querySelectorAll(".drag-card")].find(x=>x.dataset.mid===mid);
      if(!card || card.classList.contains("matched")) return;

      const ok=zone.dataset.mid===mid;
      if(ok){
        card.classList.add("matched");
        zone.classList.add("done");
        zone.querySelector(".slot").textContent="å®Œæˆ âœ…";
        state.match.done += 1;
        toast("good","âœ… é…å°æˆåŠŸï¼");
        zone.appendChild(card);
        card.draggable=false;
        card.style.cursor="default";

        if(state.match.done >= state.match.total){
          applyRoundResult(true);
          setTimeout(()=> newQuestion(), 520);
        }
      }else{
        applyRoundResult(false, {stay:true});
      }
    }

    function renderMatch(sets){
      state.match.active=true;
      state.match.total=sets.length;
      state.match.done=0;

      $("qText").textContent="æ‹–æ›³é…å°ï¼šæŠŠå·¦é‚Šé¡Œå¡æ‹–åˆ°å³é‚Šæ­£ç¢ºç­”æ¡ˆ";
      $("qHint").textContent="å®Œæˆä¸‰çµ„æ‰ç®—ç­”å°ä¸€æ¬¡ï¼›æ‹–éŒ¯ä¸€æ¬¡å°±æ‰£ä¸€æ¬¡ï¼ˆä½†å¯ç¹¼çºŒé…åˆ°å°ï¼‰ã€‚";

      $("mcqArea").style.display="none";
      $("matchArea").classList.add("show");

      const dragHost=$("dragHost");
      const dropHost=$("dropHost");
      dragHost.innerHTML="";
      dropHost.innerHTML="";

      const leftCards=shuffle(sets.slice());
      const rightSlots=shuffle(sets.slice());

      leftCards.forEach(s=>{
        const card=document.createElement("div");
        card.className="drag-card";
        card.draggable=true;
        card.dataset.mid=s.id;
        card.textContent=s.left;
        card.addEventListener("dragstart", onDragStart);
        card.addEventListener("dragend", onDragEnd);
        dragHost.appendChild(card);
      });

      rightSlots.forEach(s=>{
        const zone=document.createElement("div");
        zone.className="drop-zone";
        zone.dataset.mid=s.id;
        zone.innerHTML=`<div>${s.right}</div><div class="slot">æ”¾é¡Œå¡ â†’</div>`;
        zone.addEventListener("dragover",(e)=>{ e.preventDefault(); if(!state.paused) zone.classList.add("hover"); });
        zone.addEventListener("dragleave",()=> zone.classList.remove("hover"));
        zone.addEventListener("drop",(e)=> onDrop(e, zone));
        dropHost.appendChild(zone);
      });
    }

    const LB_KEY="JM_SPEEDQUEST_LB_V1";
    const loadLB=()=>{ try{ const raw=localStorage.getItem(LB_KEY); return raw?JSON.parse(raw):[]; }catch(e){ return []; } };
    const saveLB=(items)=> localStorage.setItem(LB_KEY, JSON.stringify(items));
    function addLB(entry){
      const items=loadLB();
      items.push(entry);
      items.sort((a,b)=>(b.score-a.score)||(b.correct-a.correct)||(b.timeLeft-a.timeLeft));
      saveLB(items.slice(0,50));
    }
    const diffLabel=(d)=> d==="easy"?"æ‚ å“‰æ…¢è·‘":(d==="hard"?"é¢¨ä¸€æ¨£å¿«":"ç¯€å¥å‰›å¥½");
    const escapeHtml=(s)=> String(s).replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;" }[m]));
    function renderLB(){
      const filter=$("lbFilterLevel").value;
      const items=loadLB().filter(x=> filter==="all" ? true : String(x.level)===filter);
      const host=$("lb"); host.innerHTML="";
      if(items.length===0){
        host.innerHTML=`<div style="padding:20px; text-align:center; color:var(--text-muted); font-weight:700; font-size:13px;">é‚„æ²’æœ‰äººä¸Šæ¦œã€‚<br>å…ˆè¡ç¬¬ä¸€å€‹å‚³èªªå§ã€‚</div>`;
        return;
      }
      items.slice(0,12).forEach((x,idx)=>{
        const div=document.createElement("div");
        div.className="lb-item";
        div.innerHTML=`
          <div style="display:flex; align-items:center;">
            <div class="rank-badge">${idx+1}</div>
            <div style="min-width:0;">
              <div style="font-weight:700; color:var(--text-main);">${escapeHtml(x.name)}</div>
              <div style="font-size:12px; color:var(--text-muted);">${LEVEL_NAMES[x.level].split("ï½œ")[0]} Â· ${diffLabel(x.diff)}</div>
            </div>
          </div>
          <div style="text-align:right;">
            <div style="font-weight:800; color:var(--primary);">${x.score} åˆ†</div>
            <div style="font-size:11px; color:var(--text-muted);">å‰© ${x.timeLeft}s</div>
          </div>
        `;
        host.appendChild(div);
      });
    }

    function show(id){
      ["stateName","stateHow","stateSelect","stateGame","stateResult"].forEach(x=> $(x).classList.remove("active"));
      $(id).classList.add("active");
    }
    function setHUD(){
      $("hudName").textContent=state.name;
      //$("hudLevel").textContent=LEVEL_NAMES[state.level].split("ï½œ")[0];
      $("hudTime").textContent=state.time;
      $("hudScore").textContent=state.score;
    }
    function toast(type,msg){
      const t=$("toast");
      t.className=`toast ${type}`;
      t.textContent=msg;
      setTimeout(()=>{ t.className="toast"; t.textContent=""; }, 750);
    }
    function lockMCQ(lock){
      ["a0","a1","a2","a3"].forEach(id=> $(id).disabled=lock);
    }
    function resetQuestionView(){
      state.match.active=false;
      $("matchArea").classList.remove("show");
      $("mcqArea").style.display="";
      $("dragHost").innerHTML="";
      $("dropHost").innerHTML="";
      ["a0","a1","a2","a3"].forEach(id=> {
         $(id).classList.remove("good","bad");
         $(id).disabled=false;
      });
    }

    function showPause(on){
      state.paused = on;
      $("pauseOverlay").classList.toggle("show", on);
      $("btnPause").textContent = on ? "ç¹¼çºŒ" : "æš«åœ";
      lockMCQ(on);
    }
    function togglePause(){
      if(!state.running) return;
      showPause(!state.paused);
    }

    function applyRoundResult(isRight, opt={}){
      if(!state.running || state.paused) return;
      const d=DIFF[state.diff];

      if(isRight){
        state.correct++;
        state.score += d.scoreGood;
        state.time = clamp(state.time + d.correctBonus, 0, 999);
        toast("good", `âœ… +${d.correctBonus}s`);
      }else{
        state.wrong++;
        state.score = Math.max(0, state.score - d.scoreBad);
        state.time = clamp(state.time - d.wrongPenalty, 0, 999);
        toast("bad", `âŒ -${d.wrongPenalty}s`);
      }
      setHUD();
      if(state.time<=0){ endGame(true); return; }
      if(opt.stay) return;
    }

    function newQuestion(){
      if(!state.running) return;
      resetQuestionView();

      if(Number(state.level)===3){
        const sets=makeMatch_Level3();
        renderMatch(sets);
        return;
      }

      const q=generateMCQ(state.level);
      state.currentQ=q;
      $("qText").textContent=q.text;
      $("qHint").textContent=q.hint;
      const opts=q.choices.all;
      ["a0","a1","a2","a3"].forEach((id,i)=> $(id).textContent=opts[i]);
    }

    function applyAnswer(idx){
      if(!state.running || state.paused) return;
      lockMCQ(true);

      const { answerIndex } = state.currentQ.choices;
      const isRight = idx===answerIndex;

      if(isRight){
        $(`a${idx}`).classList.add("good");
        applyRoundResult(true);
      }else{
        $(`a${idx}`).classList.add("bad");
        $(`a${answerIndex}`).classList.add("good");
        applyRoundResult(false);
      }

      if(state.time<=0) return;
      setTimeout(()=>{ if(state.running && !state.paused) newQuestion(); }, 520);
    }

    function startGame(){
      state.time=60;
      state.score=0;
      state.correct=0;
      state.wrong=0;
      state.running=true;
      state.paused=false;
      showPause(false);

      show("stateGame");
      setHUD();
      newQuestion();

      clearInterval(state.timerId);
      state.timerId=setInterval(()=>{
        if(!state.running || state.paused) return;
        state.time -= 1;
        $("hudTime").textContent=state.time;
        if(state.time<=0) endGame(true);
      }, DIFF[state.diff].tickMs);
    }

    function endGame(saveToLB){
      state.running=false;
      state.paused=false;
      showPause(false);
      clearInterval(state.timerId);
      lockMCQ(true);

      if(saveToLB){
        const when=new Date().toLocaleString("zh-Hant", { hour12:false });
        const entry={
          name: state.name,
          level: Number(state.level),
          diff: state.diff,
          score: state.score,
          correct: state.correct,
          wrong: state.wrong,
          timeLeft: Math.max(0, state.time),
          when
        };
        addLB(entry);
        renderLB();
      }

      $("resultText").innerHTML =
        `ç©å®¶ <b>${escapeHtml(state.name)}</b><br>` +
        `${LEVEL_NAMES[state.level]}ï½œ${diffLabel(state.diff)}<br>` +
        `<div style="font-size:24px; color:var(--primary); margin:10px 0;">${state.score} åˆ†</div>` +
        `âœ… ${state.correct} é¡Œï½œâŒ ${state.wrong} é¡Œ`;

      show("stateResult");
    }

    function backToMenu(){
      if(state.running){
        state.running=false;
        state.paused=false;
        showPause(false);
        clearInterval(state.timerId);
      }
      show("stateSelect");
    }

    $("btnNameOK").addEventListener("click", ()=>{
      const n=$("playerName").value.trim();
      if(!n){
        $("playerName").focus();
        return;
      }
      state.name=n;
      show("stateHow");
    });
    $("playerName").addEventListener("keydown",(e)=>{ if(e.key==="Enter") $("btnNameOK").click(); });

    $("btnBackName").addEventListener("click", ()=> show("stateName"));
    $("btnGoSelect").addEventListener("click", ()=> show("stateSelect"));
    $("btnBackHow").addEventListener("click", ()=> show("stateHow"));

    $("btnStartGame").addEventListener("click", ()=>{
      state.level=Number($("levelSelect").value);
      state.diff=$("diffSelect").value;
      startGame();
    });

    $("btnRestart").addEventListener("click", ()=>{
      if(state.running && confirm("ç¢ºå®šè¦é‡æ–°é–‹å§‹é€™ä¸€é—œï¼Ÿ")){
        startGame();
      }
    });
    $("btnPause").addEventListener("click", togglePause);
    $("btnBackMenu").addEventListener("click", ()=>{
      if(confirm("å›é—œå¡ä¸»é¸å–®æœƒçµæŸæœ¬å±€ï¼ˆä¸è¨˜éŒ„æ’è¡Œæ¦œï¼‰ã€‚ç¢ºå®šè¦å›å»å—ï¼Ÿ")){
        backToMenu();
      }
    });

    $("btnResume2").addEventListener("click", ()=> showPause(false));
    $("btnRestart2").addEventListener("click", ()=>{
      showPause(false);
      startGame();
    });
    $("btnBackMenu2").addEventListener("click", ()=>{
      if(confirm("å›é—œå¡ä¸»é¸å–®æœƒçµæŸæœ¬å±€ï¼ˆä¸è¨˜éŒ„æ’è¡Œæ¦œï¼‰ã€‚ç¢ºå®šå—ï¼Ÿ")){
        backToMenu();
      }
    });

    ["a0","a1","a2","a3"].forEach((id, idx)=> $(id).addEventListener("click", ()=> applyAnswer(idx)));

    $("btnAgain").addEventListener("click", ()=> startGame());
    $("btnToSelect").addEventListener("click", ()=> backToMenu());

    $("lbFilterLevel").addEventListener("change", renderLB);
    $("btnClearLB").addEventListener("click", ()=>{
      if(confirm("ç¢ºå®šè¦æ¸…ç©ºæ’è¡Œæ¦œï¼Ÿé€™æœƒæŠŠæœ¬æ©Ÿç´€éŒ„æ¸…æ‰ã€‚")){
        localStorage.removeItem(LB_KEY);
        renderLB();
      }
    });

    window.addEventListener("keydown",(e)=>{
      if(e.code==="Space"){
        e.preventDefault();
        togglePause();
      }
      if(e.key==="Escape" && state.running){
        showPause(true);
      }
    }, { passive:false });

    renderLB();
  </script>
</body>
</html>