<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jessie Math - é€Ÿç‡æŒ‘æˆ°æœªä¾†</title>

  <!-- æ§åˆ¶é è¦½å¡ç‰‡é‚£è¡Œæ–‡å­—ï¼ˆå¾ˆå¤šå¹³å°æœƒæŠ“é€™å€‹ï¼‰ -->
  <meta name="description" content="Â© 2025â€“2026 Jessie Math æ·æè€å¸«. All rights reserved.">
  <!-- LINE / FB å¸¸æŠ“é€™å€‹ï¼ˆé è¦½å¡ç‰‡çš„æè¿°æ–‡å­—ï¼‰ -->
  <meta property="og:description" content="Â© 2025â€“2026 Jessie Math æ·æè€å¸«. All rights reserved.">

  <!-- âœ… å¿«å–é€£çµé è¦½ï¼ˆè«‹æ”¾åœ¨ <head> è£¡ï¼‰ -->
  <meta name="description" content="Â© 2025â€“2026 Jessie Math æ·æè€å¸«. All rights reserved.">
  <!-- âœ… LINE / FB é è¦½ç”¨ -->
  <meta property="og:title" content="Jessie Math - é€Ÿç‡æŒ‘æˆ°æœªä¾†">
  <meta property="og:description" content="Â© 2025â€“2026 Jessie Math æ·æè€å¸«. All rights reserved.">
  <meta property="og:type" content="website">

  <!-- âœ… é è¦½åœ–ç‰‡ï¼ˆæŠŠæª”åæ›æˆä½ çš„ä¸»é¡Œåœ–ï¼Œä¾‹å¦‚ g6-u12.pngï¼‰ -->
  <meta property="og:image" content="g6-u12.png">
  <meta property="og:image:width" content="1024">
  <meta property="og:image:height" content="1536">
  <meta property="og:image:alt" content="Jessie Math éŠæˆ²å°é¢">

  <!-- âœ… æœ‰äº›å¹³å°æœƒåƒè€ƒ -->
  <link rel="image_src" href="g6-u12.png">

  <!-- âœ… Twitter / Xï¼ˆå¯ç”¨åŒä¸€å¼µåœ–ï¼‰ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Jessie Math - é€Ÿç‡æŒ‘æˆ°æœªä¾†">
  <meta name="twitter:description" content="Â© 2025â€“2026 Jessie Math æ·æè€å¸«. All rights reserved.">
  <meta name="twitter:image" content="g6-u12.png">

  <!-- Font Awesomeï¼ˆåªç‚º footer æŒ‡å—é‡ iconï¼‰ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

  <style>
    :root {
      --bg-gradient: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      --glass-bg: rgba(255, 255, 255, 0.7);
      --glass-border: rgba(255, 255, 255, 0.5);
      --primary: #475569;
      --accent: #6366f1;
      --text-main: #2d3436;
      --text-soft: #64748b;
      --good: #10b981;
      --bad: #f43f5e;
      --shadow-soft: 0 10px 40px rgba(0, 0, 0, 0.04);
      --radius-xl: 32px;
      --radius-pill: 999px;
      --transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);

      /* footer tokens */
      --footer-bg: rgba(255,255,255,0.72);
      --footer-border: rgba(255,255,255,0.55);
      --footer-ink: #334155;
      --footer-muted: #64748b;
    }

    * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }

    body {
      margin: 0;
      font-family: "PingFang TC", "Inter", system-ui, sans-serif;
      color: var(--text-main);
      background: var(--bg-gradient);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ===== Hero å€ (å°è¦½åˆ—) ===== */
    .topbar {
      background: #fff;
      border-bottom: 1px solid #eee;
      padding: 12px 0;
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    .topbar-inner {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
      flex-wrap: wrap;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      min-width: 240px;
    }
    .avatar-ring {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 2px solid #e67e22; /* æ©˜é»ƒè‰²åœˆåœˆ */
      background: transparent;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      flex: 0 0 auto;
    }
    .avatar-ring img { width: 85%; height: 85%; object-fit: contain; }
    .brand-title {
      font-size: 24px;
      font-weight: 900;
      color: #34495e;
      font-family: "Arial Black", sans-serif;
      white-space: nowrap;
    }

    .nav-group {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: flex-end;
      flex: 1 1 auto;
    }
    .nav-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 18px;
      border-radius: var(--radius-pill);
      border: 1px solid #e0e0e0;
      text-decoration: none;
      font-size: 15px;
      font-weight: 600;
      color: #555;
      transition: var(--transition);
      white-space: nowrap;
    }
    .nav-item svg { width: 18px; height: 18px; }
    .nav-item:hover { background: #f8f9fa; border-color: #ccc; }
    .nav-item.special {
      color: #6366f1;
      border-color: #6366f1;
      background: #f5f5ff;
    }

    /* ===== ä½ˆå±€å®¹å™¨ ===== */
    .container {
      max-width: 1100px;
      margin: 40px auto;
      padding: 0 20px;
      width: 100%;
      flex: 1;
    }

    .state { display: none; }
    .state.active { display: block; animation: fadeIn 0.5s ease both; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .card {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-soft);
      padding: 40px;
      margin-bottom: 24px;
    }

    /* è¼¸å…¥æ¡† */
    .inp{
      width: 100%;
      padding: 14px 16px;
      border-radius: 16px;
      border: 1px solid #e2e8f0;
      background: #fff;
      font-size: 16px;
      font-weight: 700;
      outline: none;
      transition: var(--transition);
      box-shadow: 0 6px 18px rgba(0,0,0,0.03);
    }
    .inp:focus{
      border-color: rgba(99,102,241,.7);
      box-shadow: 0 10px 28px rgba(99,102,241,0.12);
    }

    /* ===== ç¬¬ä¸€é  ===== */
    .rule-box {
      background: rgba(255, 255, 255, 0.4);
      border-radius: 20px;
      padding: 24px;
      margin: 24px 0;
      font-size: 15px;
      line-height: 1.8;
      color: var(--text-soft);
    }

    /* ===== ç¬¬äºŒé ï¼šæ”¤é–‹å¼é¸æ“‡å™¨ ===== */
    .lobby-grid { display: grid; grid-template-columns: 1fr 340px; gap: 24px; }
    .option-group { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px; margin-bottom: 32px; }

    .choice-btn {
      padding: 16px;
      border-radius: 16px;
      border: 2px solid #e2e8f0;
      background: #fff;
      cursor: pointer;
      text-align: center;
      font-weight: 700;
      transition: var(--transition);
      color: var(--text-soft);
      user-select: none;
    }
    .choice-btn:hover { border-color: var(--accent); color: var(--accent); }
    .choice-btn.selected {
      border-color: var(--accent);
      background: #f5f5ff;
      color: var(--accent);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1);
    }

    /* ===== ç¬¬ä¸‰é ï¼šéŠæˆ²ç•«é¢èˆ‡æŒ‰éˆ• ===== */
    .game-hud { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; gap: 12px; flex-wrap: wrap; }
    .hud-item { background: #fff; padding: 12px 24px; border-radius: 16px; box-shadow: var(--shadow-soft); text-align: center; min-width: 140px; }
    .hud-label { font-size: 11px; color: var(--text-soft); font-weight: 800; letter-spacing: .06em; }
    .hud-val { font-size: 22px; font-weight: 900; color: var(--accent); }

    .question-card { background: #fff; border-radius: 24px; padding: 60px 40px; text-align: center; box-shadow: var(--shadow-soft); margin-bottom: 24px; }
    .q-text { font-size: 28px; font-weight: 800; margin-bottom: 18px; color: var(--text-main); line-height: 1.35; }

    .q-sub {
      font-size: 14px;
      color: var(--text-soft);
      font-weight: 800;
      margin-bottom: 28px;
      letter-spacing: .02em;
    }

    .answers-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .ans-btn {
      background: #fff; border: 2px solid #f1f5f9; border-radius: 20px; padding: 22px 18px;
      font-size: 18px; font-weight: 800; cursor: pointer; transition: var(--transition);
      line-height: 1.25;
      min-height: 72px;
    }
    .ans-btn:hover:not(:disabled) { border-color: var(--accent); background: #fdfdff; }
    .ans-btn:disabled{ opacity: .9; cursor: not-allowed; }
    .ans-btn.good { background: var(--good); color: #fff; border-color: var(--good); }
    .ans-btn.bad { background: var(--bad); color: #fff; border-color: var(--bad); }

    .btn {
      padding: 16px 32px; border-radius: 16px; font-weight: 800; font-size: 16px;
      cursor: pointer; border: none; transition: var(--transition);
      display: inline-flex; align-items: center; justify-content: center; gap: 8px;
      user-select: none;
    }
    .btn-primary { background: #2d3436; color: white; }
    .btn-primary:hover { transform: translateY(-1px); }
    .btn-ghost { background: #fff; color: var(--text-soft); border: 1px solid #e2e8f0; }
    .btn-ghost:hover { transform: translateY(-1px); border-color: #cbd5e1; }

    /* æ’è¡Œæ¦œ */
    .lb-item { display: flex; justify-content: space-between; padding: 14px; background: #fff; margin-bottom: 8px; border-radius: 12px; font-size: 14px; border: 1px solid #f1f5f9; }
    .lb-item b{ color: var(--accent); }

    .toast {
      position: fixed;
      top: 120px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 22px;
      border-radius: 99px;
      color: white;
      font-weight: 900;
      z-index: 2000;
      display: none;
      box-shadow: 0 10px 20px rgba(0,0,0,0.12);
      max-width: calc(100vw - 24px);
      text-align: center;
      line-height: 1.3;
      letter-spacing: .02em;
    }

    /* ===== Footer (ä¾ä½ æä¾›çš„çµæ§‹) ===== */
    footer{
      width: 100%;
      padding: 18px 16px 26px;
    }
    .footer-pill{
      max-width: 1100px;
      margin: 0 auto;
      background: var(--footer-bg);
      border: 1px solid var(--footer-border);
      border-radius: 999px;
      padding: 14px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(10px);
    }
    .footer-left, .footer-right{
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .footer-dot{
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), #a78bfa);
      box-shadow: 0 0 0 4px rgba(99,102,241,0.10);
      flex: 0 0 auto;
    }
    .footer-copy{
      font-weight: 900;
      color: var(--footer-ink);
      font-size: 13px;
      letter-spacing: .01em;
      white-space: nowrap;
    }
    .footer-icon{
      width: 30px;
      height: 30px;
      border-radius: 999px;
      display: grid;
      place-items: center;
      background: #fff;
      border: 1px solid #e2e8f0;
      color: var(--accent);
      box-shadow: 0 8px 18px rgba(0,0,0,0.05);
      flex: 0 0 auto;
    }
    .footer-tagline{
      font-weight: 900;
      color: var(--footer-muted);
      font-size: 13px;
      white-space: nowrap;
    }

    /* RWD */
    @media (max-width: 980px){
      .lobby-grid{ grid-template-columns: 1fr; }
    }
    @media (max-width: 640px){
      .container{ margin: 18px auto; padding: 0 14px; }
      .card{ padding: 22px; border-radius: 24px; }
      .question-card{ padding: 26px 18px; border-radius: 22px; }
      .q-text{ font-size: 20px; }
      .answers-grid{ grid-template-columns: 1fr; }
      .hud-item{ min-width: 128px; padding: 10px 14px; border-radius: 14px; }
      .hud-val{ font-size: 20px; }
      .nav-item{ padding: 8px 14px; font-size: 14px; }
      .brand-title{ font-size: 20px; }
      .avatar-ring{ width: 42px; height: 42px; }
      .btn{ padding: 14px 18px; border-radius: 14px; }

      footer{ padding: 14px 12px 22px; }
      .footer-pill{
        border-radius: 24px;   /* æ‰‹æ©Ÿä¸ç¡¬å¡è†¨è„¹ pillï¼Œæ”¹æˆèˆ’æœå¡ç‰‡ */
        padding: 14px 14px;
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      .footer-copy, .footer-tagline{ white-space: normal; }
    }
  </style>
</head>

<body>

  <header class="topbar">
    <div class="topbar-inner">
      <a href="https://jessiemath0703-chu.github.io/website2/" class="brand">
        <div class="avatar-ring"><img src="JESSIEMATH-Q.png" alt="Logo" /></div>
        <span class="brand-title">Jessie Math</span>
      </a>
      <div class="nav-group">
        <a href="https://jessiemath0703-chu.github.io/website2/" class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          é¦–é 
        </a>
        <a href="https://jessiemath0703-chu.github.io/Game-Lobby/" class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
          éŠæˆ²å¤§å»³
        </a>
        <a href="https://jessiemath0703-chu.github.io/Game-Lobby/#g6-u12" class="nav-item special">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
          å…­å¹´ç´šé€Ÿç‡
        </a>
      </div>
    </div>
  </header>

  <main class="container">

    <div id="stateStart" class="state active">
      <div class="card">
        <h2 style="margin:0; font-size: 32px;">æŒ‘æˆ°è€…ç™»å…¥</h2>
        <div class="rule-box">
          <b>ğŸ“œ æŒ‘æˆ°æŒ‡å—</b><br>
          â€¢ æ¯ä¸€é—œé™æ™‚ <b>60 ç§’</b>ã€‚<br>
          â€¢ ç­”å°é¡Œç›®ï¼šæ™‚é–“ <b>+5 ç§’</b>ã€‚<br>
          â€¢ ç­”éŒ¯é¡Œç›®ï¼šæ™‚é–“ <b>-5 ç§’</b>ï¼Œä¸¦é¡¯ç¤º <b>æ­£ç¢ºç­”æ¡ˆ</b>ã€‚<br>
          â€¢ é¡Œå‹æœƒä¾ã€Œé—œå¡ Ã— é›£æ˜“åº¦ã€éš¨æ©Ÿè®ŠåŒ–ã€‚<br>
          â€¢ æœ€çµ‚ç©åˆ†å°‡ç´€éŒ„æ–¼æœ¬æ©Ÿæ’è¡Œæ¦œä¸­ã€‚
        </div>
        <input id="playerName" class="inp" type="text" maxlength="16" placeholder="è«‹è¼¸å…¥æŒ‘æˆ°è€…æš±ç¨±..." style="margin-bottom:20px;" />
        <button id="btnToLobby" class="btn btn-primary" style="width:100%;">é€²å…¥æŒ‘æˆ°å¤§å»³</button>
      </div>
    </div>

    <div id="stateLobby" class="state">
      <div class="lobby-grid">
        <div class="card">
          <h3 style="margin:0 0 20px;">1. é¸æ“‡é—œå¡</h3>
          <div id="levelGrid" class="option-group">
            <div class="choice-btn selected" data-val="1">èªè­˜é€Ÿç‡</div>
            <div class="choice-btn" data-val="2">é—œä¿‚å¼æ‡‰ç”¨</div>
            <div class="choice-btn" data-val="3">å–®ä½æ›ç®—</div>
            <div class="choice-btn" data-val="4">å¹³å‡é€Ÿç‡</div>
            <div class="choice-btn" data-val="5">ç”Ÿæ´»æ‡‰ç”¨</div>
          </div>

          <h3 style="margin:0 0 20px;">2. é›£æ˜“åº¦</h3>
          <div id="diffGrid" class="option-group">
            <div class="choice-btn" data-val="easy">æ‚ å“‰æ…¢è·‘</div>
            <div class="choice-btn selected" data-val="normal">ç¯€å¥å‰›å¥½</div>
            <div class="choice-btn" data-val="hard">é¢¨ä¸€æ¨£å¿«</div>
          </div>

          <div style="display:flex; gap:12px; margin-top:20px; flex-wrap:wrap;">
            <button id="btnStartGame" class="btn btn-primary" style="flex:1; min-width: 180px;">é–‹å§‹æŒ‘æˆ°</button>
            <button id="btnBackToStart" class="btn btn-ghost" style="min-width: 140px;">å›ä¸Šä¸€é </button>
          </div>
        </div>

        <aside class="card" style="padding:30px;">
          <h3 style="margin:0 0 20px;">ğŸ† æ’è¡Œæ¦œ</h3>
          <div id="lb"></div>
        </aside>
      </div>
    </div>

    <div id="stateGame" class="state">
      <div class="game-hud">
        <div class="hud-item">
          <div class="hud-label">å‰©é¤˜æ™‚é–“</div>
          <div id="hudTime" class="hud-val">60</div>
        </div>
        <div class="hud-item">
          <div class="hud-label">å¾—åˆ†</div>
          <div id="hudScore" class="hud-val">0</div>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <button id="btnPause" class="btn btn-ghost" style="padding:10px 20px;">æš«åœ</button>
          <button id="btnRestartInGame" class="btn btn-ghost" style="padding:10px 20px;">é‡ä¾†</button>
        </div>
      </div>

      <div id="toast" class="toast"></div>

      <div class="question-card">
        <div id="qText" class="q-text">æº–å‚™ä¸­...</div>
        <div id="qSub" class="q-sub"> </div>

        <div id="mcqArea" class="answers-grid">
          <button class="ans-btn" id="a0"></button>
          <button class="ans-btn" id="a1"></button>
          <button class="ans-btn" id="a2"></button>
          <button class="ans-btn" id="a3"></button>
        </div>
      </div>

      <div style="text-align:center;">
        <button id="btnBackMenu" class="btn btn-ghost">æ”¾æ£„æŒ‘æˆ°</button>
      </div>
    </div>

    <div id="stateResult" class="state">
      <div class="card" style="text-align:center;">
        <h2 style="font-size:48px; color:var(--accent);">æŒ‘æˆ°çµæœ</h2>
        <div id="resultText" style="line-height:2; margin:30px 0; font-size:20px; font-weight:800;"></div>
        <div style="display:flex; gap:16px; justify-content:center; flex-wrap:wrap;">
          <button id="btnAgain" class="btn btn-primary">å†ç©ä¸€æ¬¡</button>
          <button onclick="show('stateLobby')" class="btn btn-ghost">å›åˆ°å¤§å»³</button>
        </div>
      </div>
    </div>

  </main>

  <!-- âœ… ç•™ä¸€çµ„ï¼šFooterï¼ˆä½ æŒ‡å®šçš„é‚£ä¸€çµ„ï¼‰ -->
  <footer>
        <div class="footer-pill">
            <div class="footer-left">
                <div class="footer-dot" aria-hidden="true"></div>
                <div class="footer-copy">Â© 2025â€“2026 Jessie Math æ·æè€å¸«. All rights reserved.</div>
            </div>
            <div class="footer-right">
                <div class="footer-icon" aria-hidden="true"><i class="fas fa-compass"></i></div>
                <div class="footer-tagline">æ•¸å­¸ä¸è¿·è·¯ï¼ŒJessie å¸¶ä½ èµ°å‘ç†è§£ã€‚</div>
            </div>
        </div>
    </footer>

  <div id="pauseOverlay" class="overlay" style="position:fixed; inset:0; background:rgba(0,0,0,0.4); backdrop-filter:blur(8px); display:none; place-items:center; z-index:3000;">
    <div class="card" style="text-align:center; min-width:280px;">
      <h2>æš«åœä¸­</h2>
      <button id="btnResume" class="btn btn-primary" style="width:100%;">ç¹¼çºŒéŠæˆ²</button>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const state = {
      name: "", level: 1, diff: "normal", time: 60, score: 0,
      correct: 0, wrong: 0, running: false, paused: false,
      timerId: null, currentQ: null, lock: false
    };

    // é é¢åˆ‡æ›
    function show(id) {
      document.querySelectorAll('.state').forEach(s => s.classList.remove('active'));
      $(id).classList.add('active');
    }

    // åˆå§‹åŒ–æ”¤é–‹æŒ‰éˆ•é»æ“Šäº‹ä»¶
    function initChoiceBtns(containerId, stateKey) {
      const btns = $(containerId).querySelectorAll('.choice-btn');
      btns.forEach(btn => {
        btn.onclick = () => {
          btns.forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          state[stateKey] = btn.dataset.val;
        };
      });
    }
    initChoiceBtns('levelGrid', 'level');
    initChoiceBtns('diffGrid', 'diff');

    // é€²å…¥å¤§å»³ï¼šå¼·åˆ¶è¼¸å…¥åå­—
    $("btnToLobby").onclick = () => {
      const n = $("playerName").value.trim();
      if(!n) return alert("è«‹è¼¸å…¥æš±ç¨±ï¼");
      state.name = n;
      show("stateLobby");
      renderLB();
    };

    $("btnBackToStart").onclick = () => show("stateStart");
    $("btnStartGame").onclick = () => startGame();
    $("btnRestartInGame").onclick = () => { if(confirm("ç¢ºå®šè¦é‡æ–°é–‹å§‹æœ¬å±€ï¼Ÿ")) startGame(); };

    // é›£æ˜“åº¦åƒæ•¸
    function diffCfg() {
      if(state.diff === "easy") return { vMin: 5, vMax: 30, tMin: 2, tMax: 10, dMin: 20, dMax: 400 };
      if(state.diff === "hard") return { vMin: 18, vMax: 80, tMin: 3, tMax: 25, dMin: 80, dMax: 3000 };
      return { vMin: 10, vMax: 55, tMin: 2, tMax: 18, dMin: 50, dMax: 1200 };
    }

    function startGame() {
      state.time = 60;
      state.score = 0;
      state.correct = 0;
      state.wrong = 0;
      state.running = true;
      state.paused = false;
      state.lock = false;

      show("stateGame");
      updateHUD();
      newQuestion();

      clearInterval(state.timerId);
      state.timerId = setInterval(() => {
        if(!state.running || state.paused) return;
        state.time--;
        $("hudTime").textContent = state.time;
        if(state.time <= 0) endGame();
      }, 1000);
    }

    function updateHUD() {
      $("hudScore").textContent = state.score;
      $("hudTime").textContent = state.time;
    }

    // å°å·¥å…·
    const randInt = (a,b)=> Math.floor(Math.random()*(b-a+1))+a;
    const shuffle = (arr)=> arr.map(v=>({v, r:Math.random()})).sort((a,b)=>a.r-b.r).map(o=>o.v);

    function formatUnit(val, unit){
      const x = (Math.abs(val) < 1e-9) ? 0 : val;
      return `${x}${unit}`;
    }

    // ç”Ÿæˆã€Œåˆç†ã€å¹²æ“¾é¸é …
    function makeChoices(ans, unit, mode="int"){
      let base = ans;
      let opts = new Set([base]);

      const tryAdd = (x)=>{
        if(mode==="int") x = Math.round(x);
        if(mode==="oneDec") x = Math.round(x*10)/10;
        if(mode==="twoDec") x = Math.round(x*100)/100;
        if(!Number.isFinite(x)) return;
        opts.add(x);
      };

      tryAdd(base + (mode==="int"? randInt(2,20) : 0.5));
      tryAdd(base - (mode==="int"? randInt(2,15) : 0.5));
      tryAdd(base * 2);
      tryAdd(base / 2);
      tryAdd(base * 1.5);
      tryAdd(base * 0.8);

      while(opts.size < 4){
        const bump = (mode==="int") ? randInt(-30,30) : (randInt(-20,20)/10);
        tryAdd(base + bump);
      }

      const list = shuffle(Array.from(opts)).slice(0,4);
      return list.map(x => ({ val:x, label: formatUnit(x, unit) }));
    }

    // é¡Œåº«ï¼šä¾ã€Œé—œå¡ã€èµ°ä¸åŒé¡Œå‹æ± 
    function genQ_level1(){ // èªè­˜é€Ÿç‡
      const cfg = diffCfg();
      const type = randInt(1,3);

      if(type === 1){ // æ±‚è·é›¢
        const v = randInt(cfg.vMin, cfg.vMax);
        const t = randInt(cfg.tMin, cfg.tMax);
        const ans = v * t;
        return { text: `è‹¥é€Ÿç‡ç‚º ${v} m/sï¼Œæ™‚é–“ç‚º ${t} ç§’ï¼Œè·é›¢æ˜¯å¤šå°‘ï¼Ÿ`, sub: `æç¤ºï¼šè·é›¢ = é€Ÿç‡ Ã— æ™‚é–“`, ans, unit: " å…¬å°º", mode:"int" };
      }
      if(type === 2){ // æ±‚é€Ÿç‡
        const t = randInt(cfg.tMin, cfg.tMax);
        const v = randInt(cfg.vMin, cfg.vMax);
        const d = v * t;
        return { text: `ä¸€æ®µè·¯ç¨‹ ${d} å…¬å°ºï¼Œèµ°äº† ${t} ç§’ï¼Œé€Ÿç‡æ˜¯å¤šå°‘ï¼Ÿ`, sub: `æç¤ºï¼šé€Ÿç‡ = è·é›¢ Ã· æ™‚é–“`, ans: v, unit: " m/s", mode:"int" };
      }
      // æ±‚æ™‚é–“
      const v = randInt(cfg.vMin, cfg.vMax);
      const t = randInt(cfg.tMin, cfg.tMax);
      const d = v * t;
      return { text: `é€Ÿç‡ç‚º ${v} m/sï¼Œè·é›¢ç‚º ${d} å…¬å°ºï¼Œæ™‚é–“æ˜¯å¤šå°‘ç§’ï¼Ÿ`, sub: `æç¤ºï¼šæ™‚é–“ = è·é›¢ Ã· é€Ÿç‡`, ans: t, unit: " ç§’", mode:"int" };
    }

    function genQ_level2(){ // é—œä¿‚å¼æ‡‰ç”¨
      const cfg = diffCfg();
      const type = randInt(1,3);

      if(type === 1){
        const vA = randInt(cfg.vMin, cfg.vMax);
        const vB = randInt(cfg.vMin, cfg.vMax);
        const t = randInt(cfg.tMin, cfg.tMax);
        const ans = Math.abs(vA*t - vB*t);
        return { text: `ç”²é€Ÿç‡ ${vA} m/sï¼Œä¹™é€Ÿç‡ ${vB} m/sï¼ŒåŒèµ° ${t} ç§’ï¼Œå…©äººè·é›¢å·®å¤šå°‘å…¬å°ºï¼Ÿ`, sub:`æç¤ºï¼šå…ˆç®—å„è‡ªè·é›¢ï¼Œå†ç›¸æ¸›`, ans, unit:" å…¬å°º", mode:"int" };
      }
      if(type === 2){
        const vSlow = randInt(cfg.vMin, cfg.vMax-5);
        const vFast = randInt(vSlow+5, cfg.vMax+10);
        const diff = vFast - vSlow;
        const t = randInt(2,20);
        const lead = diff * t;
        return { text: `ä¹™æ¯”ç”²å…ˆå‰é€² ${lead} å…¬å°ºï¼Œç”²é€Ÿç‡ ${vFast} m/sã€ä¹™é€Ÿç‡ ${vSlow} m/sï¼ŒåŒæ–¹å‘å‰é€²ï¼Œç”²å¹¾ç§’è¿½ä¸Šä¹™ï¼Ÿ`, sub:`æç¤ºï¼šè¿½åŠæ™‚é–“ = è·é›¢å·® Ã· é€Ÿç‡å·®`, ans:t, unit:" ç§’", mode:"int" };
      }
      const v1 = randInt(cfg.vMin, cfg.vMax);
      const k = randInt(2,4);
      const v2 = v1 * k;
      const t = randInt(cfg.tMin, cfg.tMax);
      return { text:`ç”²é€Ÿç‡ ${v1} m/sï¼Œä¹™é€Ÿç‡æ˜¯ç”²çš„ ${k} å€ï¼Œè‹¥ä¹™èµ°äº† ${t} ç§’ï¼Œä¹™èµ°äº†å¤šå°‘å…¬å°ºï¼Ÿ`, sub:`æç¤ºï¼šä¹™é€Ÿç‡ = ç”²é€Ÿç‡ Ã— å€æ•¸ï¼Œå†ç®—è·é›¢`, ans:v2*t, unit:" å…¬å°º", mode:"int" };
    }

    function genQ_level3(){ // å–®ä½æ›ç®—
      const type = randInt(1,3);

      if(type === 1){
        const base = [18, 36, 54, 72, 90, 108];
        const v = base[randInt(0, base.length-1)];
        const ans = Math.round((v/3.6)*10)/10;
        return { text:`å°‡é€Ÿç‡ ${v} km/h æ›ç®—æˆ m/sï¼Œç´„æ˜¯å¤šå°‘ï¼Ÿ`, sub:`æç¤ºï¼škm/h Ã· 3.6 = m/sï¼ˆå–åˆ°å°æ•¸ç¬¬ 1 ä½ï¼‰`, ans, unit:" m/s", mode:"oneDec" };
      }
      if(type === 2){
        const base = [5, 8, 10, 12.5, 15, 20];
        const v = base[randInt(0, base.length-1)];
        const ans = Math.round((v*3.6)*10)/10;
        return { text:`å°‡é€Ÿç‡ ${v} m/s æ›ç®—æˆ km/hï¼Œç´„æ˜¯å¤šå°‘ï¼Ÿ`, sub:`æç¤ºï¼šm/s Ã— 3.6 = km/hï¼ˆå–åˆ°å°æ•¸ç¬¬ 1 ä½ï¼‰`, ans, unit:" km/h", mode:"oneDec" };
      }
      const mps = randInt(2,20);
      const v = mps * 60;
      return { text:`è‹¥é€Ÿç‡æ˜¯ ${v} å…¬å°º/åˆ†é˜ï¼Œæ›ç®—æˆ m/s æ˜¯å¤šå°‘ï¼Ÿ`, sub:`æç¤ºï¼š1 åˆ†é˜ = 60 ç§’ï¼Œæ‰€ä»¥ Ã· 60`, ans:mps, unit:" m/s", mode:"int" };
    }

    function genQ_level4(){ // å¹³å‡é€Ÿç‡
      const cfg = diffCfg();
      const type = randInt(1,3);

      if(type === 1){
        const v1 = randInt(cfg.vMin, cfg.vMax);
        const v2 = randInt(cfg.vMin, cfg.vMax);
        const t1 = randInt(cfg.tMin, cfg.tMax);
        const t2 = randInt(cfg.tMin, cfg.tMax);
        const d1 = v1 * t1;
        const d2 = v2 * t2;
        const ans = Math.round(((d1+d2)/(t1+t2))*10)/10;
        return { text:`ç”²å…ˆä»¥ ${v1} m/s èµ° ${t1} ç§’ï¼Œå†ä»¥ ${v2} m/s èµ° ${t2} ç§’ï¼Œå¹³å‡é€Ÿç‡ç´„å¤šå°‘ m/sï¼Ÿ`, sub:`æç¤ºï¼šå¹³å‡é€Ÿç‡ = ç¸½è·é›¢ Ã· ç¸½æ™‚é–“ï¼ˆå–åˆ°å°æ•¸ç¬¬ 1 ä½ï¼‰`, ans, unit:" m/s", mode:"oneDec" };
      }
      if(type === 2){
        const d = randInt(100, 400) * (state.diff==="hard"? 4 : 1);
        const vGo = randInt(cfg.vMin, cfg.vMax);
        const vBack = randInt(cfg.vMin, cfg.vMax);
        const tGo = d / vGo;
        const tBack = d / vBack;
        const ans = Math.round(((2*d)/(tGo+tBack))*10)/10;
        return { text:`åŒä¸€æ®µè·é›¢ä¾†å›å„ ${d} å…¬å°ºï¼Œå»ç¨‹é€Ÿç‡ ${vGo} m/sï¼Œå›ç¨‹é€Ÿç‡ ${vBack} m/sï¼Œå¹³å‡é€Ÿç‡ç´„å¤šå°‘ m/sï¼Ÿ`, sub:`æç¤ºï¼šå¹³å‡é€Ÿç‡ = ç¸½è·é›¢ Ã· ç¸½æ™‚é–“ï¼ˆå–åˆ°å°æ•¸ç¬¬ 1 ä½ï¼‰`, ans, unit:" m/s", mode:"oneDec" };
      }
      const t1 = randInt(cfg.tMin, cfg.tMax);
      const t2 = randInt(cfg.tMin, cfg.tMax);
      const v1 = randInt(cfg.vMin, cfg.vMax);
      const v2 = randInt(cfg.vMin, cfg.vMax);
      const d1 = v1 * t1;
      const d2 = v2 * t2;
      const ans = Math.round(((d1+d2)/(t1+t2))*10)/10;
      return { text:`å…ˆèµ° ${d1} å…¬å°ºç”¨ ${t1} ç§’ï¼Œå†èµ° ${d2} å…¬å°ºç”¨ ${t2} ç§’ï¼Œå¹³å‡é€Ÿç‡ç´„å¤šå°‘ m/sï¼Ÿ`, sub:`æç¤ºï¼šå¹³å‡é€Ÿç‡ = (d1+d2) Ã· (t1+t2)ï¼ˆå–åˆ°å°æ•¸ç¬¬ 1 ä½ï¼‰`, ans, unit:" m/s", mode:"oneDec" };
    }

    function genQ_level5(){ // ç”Ÿæ´»æ‡‰ç”¨
      const cfg = diffCfg();
      const type = randInt(1,3);

      if(type === 1){
        const minutes = randInt(10, 60);
        const speed = randInt(10, 30) + (state.diff==="hard"? randInt(0,10):0);
        const dist = Math.round((speed * (minutes/60))*10)/10;
        return { text:`è…³è¸è»Šé¨äº† ${dist} å…¬é‡Œï¼Œç”¨äº† ${minutes} åˆ†é˜ï¼Œå¹³å‡é€Ÿç‡ç´„å¤šå°‘ km/hï¼Ÿ`, sub:`æç¤ºï¼šå…ˆæŠŠåˆ†é˜æ›æˆå°æ™‚ï¼Œå†ç”¨ è·é›¢ Ã· æ™‚é–“ï¼ˆå–åˆ°å°æ•¸ç¬¬ 1 ä½ï¼‰`, ans: Math.round(speed*10)/10, unit:" km/h", mode:"oneDec" };
      }
      if(type === 2){
        const v = randInt(cfg.vMin, cfg.vMax);
        const t = randInt(cfg.tMin, cfg.tMax);
        const d = v * t;
        return { text:`æ™¨è·‘é€Ÿç‡ç´„ ${v} m/sï¼Œè‹¥è¦è·‘å®Œ ${d} å…¬å°ºï¼Œå¤§ç´„è¦å¹¾ç§’ï¼Ÿ`, sub:`æç¤ºï¼šæ™‚é–“ = è·é›¢ Ã· é€Ÿç‡`, ans:t, unit:" ç§’", mode:"int" };
      }
      const v = [36, 45, 54, 60, 72][randInt(0,4)];
      const minutes = [10, 12, 15, 18, 20][randInt(0,4)];
      const dist = Math.round((v * (minutes/60))*10)/10;
      return { text:`å…¬è»Šæ™‚é€Ÿç´„ ${v} km/hï¼Œè‹¥ç›®çš„åœ°è·é›¢ ${dist} å…¬é‡Œï¼Œå¤§ç´„è¦å¹¾åˆ†é˜åˆ°ï¼Ÿ`, sub:`æç¤ºï¼šæ™‚é–“(å°æ™‚)=è·é›¢Ã·é€Ÿç‡ï¼Œå†æ›æˆåˆ†é˜`, ans: minutes, unit:" åˆ†é˜", mode:"int" };
    }

    function generateQuestionByLevel(){
      const lv = String(state.level);
      if(lv === "1") return genQ_level1();
      if(lv === "2") return genQ_level2();
      if(lv === "3") return genQ_level3();
      if(lv === "4") return genQ_level4();
      return genQ_level5();
    }

    function newQuestion() {
      state.lock = false;

      const q = generateQuestionByLevel();
      state.currentQ = q;

      $("qText").textContent = q.text;
      $("qSub").textContent = q.sub || "";

      const opts = makeChoices(q.ans, q.unit, q.mode);
      if(!opts.some(o => String(o.val) === String(q.ans))){
        opts[0] = { val: q.ans, label: formatUnit(q.ans, q.unit) };
      }
      const final = shuffle(opts);

      [0,1,2,3].forEach(i => {
        const btn = $(`a${i}`);
        btn.textContent = final[i].label;
        btn.className = "ans-btn";
        btn.disabled = false;
        btn.onclick = () => checkAns(final[i].val, i, final);
      });
    }

    function lockAnswers(){
      [0,1,2,3].forEach(i => { $(`a${i}`).disabled = true; });
    }

    function highlightCorrect(final){
      final.forEach((o, i)=>{
        if(String(o.val) === String(state.currentQ.ans)){
          $(`a${i}`).classList.add("good");
        }
      });
    }

    function checkAns(val, idx, final) {
      if(state.lock) return;
      state.lock = true;

      lockAnswers();

      const q = state.currentQ;
      const correct = (String(val) === String(q.ans));

      if(correct) {
        state.score += 10;
        state.time += 5;
        state.correct++;
        $(`a${idx}`).classList.add("good");
        showToast("ç­”å°äº†ï¼+5 ç§’ âœ¨", "var(--good)");
      } else {
        state.time -= 5;
        state.wrong++;
        $(`a${idx}`).classList.add("bad");
        highlightCorrect(final);
        const ansLabel = formatUnit(q.ans, q.unit);
        showToast(`ç­”éŒ¯äº†ï¼æ­£ç¢ºç­”æ¡ˆï¼š${ansLabel}ï¼ˆ-5 ç§’ï¼‰`, "var(--bad)");
      }

      updateHUD();

      setTimeout(() => {
        if(state.running && state.time > 0) newQuestion();
        else if(state.time <= 0) endGame();
      }, 950);
    }

    function showToast(msg, color) {
      const t = $("toast");
      t.textContent = msg;
      t.style.background = color;
      t.style.display = "block";
      clearTimeout(t._tid);
      t._tid = setTimeout(() => t.style.display = "none", 1000);
    }

    function endGame() {
      state.running = false;
      clearInterval(state.timerId);
      saveLB();
      $("resultText").innerHTML =
        `æŒ‘æˆ°è€…ï¼š${state.name}<br>`+
        `æœ€çµ‚å¾—åˆ†ï¼š${state.score}<br>`+
        `æ­£ç¢ºï¼š${state.correct} é¡Œ | éŒ¯èª¤ï¼š${state.wrong} é¡Œ`;
      show("stateResult");
    }

    function saveLB() {
      let data = JSON.parse(localStorage.getItem("SPEED_LB") || "[]");
      data.push({ name: state.name, score: state.score });
      data.sort((a,b) => b.score - a.score);
      localStorage.setItem("SPEED_LB", JSON.stringify(data.slice(0, 8)));
    }

    function renderLB() {
      let data = JSON.parse(localStorage.getItem("SPEED_LB") || "[]");
      $("lb").innerHTML = data.map(i =>
        `<div class="lb-item"><span>${i.name}</span><b>${i.score} åˆ†</b></div>`
      ).join('') || "å°šç„¡ç´€éŒ„";
    }

    $("btnBackMenu").onclick = () => {
      if(confirm("ç¢ºå®šæ”¾æ£„æœ¬å±€ï¼Ÿ")) {
        state.running = false;
        clearInterval(state.timerId);
        show("stateLobby");
      }
    };
    $("btnAgain").onclick = () => startGame();

    $("btnPause").onclick = () => {
      state.paused = true;
      $("pauseOverlay").style.display = "grid";
    };
    $("btnResume").onclick = () => {
      state.paused = false;
      $("pauseOverlay").style.display = "none";
    };
  </script>
</body>
</html>

